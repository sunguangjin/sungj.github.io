<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="hooks," />










<meta name="description" content="React Hooks èµ·æº React ä¸€ç›´éƒ½æå€¡ä½¿ç”¨å‡½æ•°å¼ç»„ä»¶ã€‚æ›´è½»ä¾¿ï¼Œæ›´ä¼˜é›…ï¼Œæ€§èƒ½æ›´ä½³ã€‚å‡½æ•°å¼ç»„ä»¶åˆç§°æ— çŠ¶æ€ç»„ä»¶(FSC)ã€‚ ä»¥å‰ï¼Œéœ€è¦ä½¿ç”¨ state ï¼Œç”Ÿå‘½å‘¨æœŸç­‰React ç‰¹æ€§ï¼Œå¿…é¡»é‡æ„ä¸º class ç»„ä»¶ã€‚ Hooks æ˜¯ React 16.8 æ–°å¢çš„ç‰¹æ€§ï¼Œå®ƒå¯ä»¥è®©ä½ åœ¨ä¸ç¼–å†™ class çš„æƒ…å†µä¸‹ä½¿ç”¨ state ä»¥åŠå…¶ä»–çš„ React ç‰¹æ€§ã€‚ ç°åœ¨ï¼Œä½ å¯ä»¥ç›´æ¥åœ¨ç°æœ‰çš„å‡½æ•°å¼ç»„ä»¶ä¸­ä½¿">
<meta property="og:type" content="article">
<meta property="og:title" content="æ‹¥æŠ± React Hooks ï¼ˆä¸€ï¼‰åŸºç¡€">
<meta property="og:url" content="http://www.mala520.life/2020/03/18/%E6%8B%A5%E6%8A%B1React-Hooks/index.html">
<meta property="og:site_name" content="Live and learn">
<meta property="og:description" content="React Hooks èµ·æº React ä¸€ç›´éƒ½æå€¡ä½¿ç”¨å‡½æ•°å¼ç»„ä»¶ã€‚æ›´è½»ä¾¿ï¼Œæ›´ä¼˜é›…ï¼Œæ€§èƒ½æ›´ä½³ã€‚å‡½æ•°å¼ç»„ä»¶åˆç§°æ— çŠ¶æ€ç»„ä»¶(FSC)ã€‚ ä»¥å‰ï¼Œéœ€è¦ä½¿ç”¨ state ï¼Œç”Ÿå‘½å‘¨æœŸç­‰React ç‰¹æ€§ï¼Œå¿…é¡»é‡æ„ä¸º class ç»„ä»¶ã€‚ Hooks æ˜¯ React 16.8 æ–°å¢çš„ç‰¹æ€§ï¼Œå®ƒå¯ä»¥è®©ä½ åœ¨ä¸ç¼–å†™ class çš„æƒ…å†µä¸‹ä½¿ç”¨ state ä»¥åŠå…¶ä»–çš„ React ç‰¹æ€§ã€‚ ç°åœ¨ï¼Œä½ å¯ä»¥ç›´æ¥åœ¨ç°æœ‰çš„å‡½æ•°å¼ç»„ä»¶ä¸­ä½¿">
<meta property="og:image" content="http://www.mala520.life/2020/03/18/%E6%8B%A5%E6%8A%B1React-Hooks/hooks-1.jpg">
<meta property="article:published_time" content="2020-03-18T06:16:43.000Z">
<meta property="article:modified_time" content="2021-10-25T01:58:57.975Z">
<meta property="article:author" content="ç¥è¿">
<meta property="article:tag" content="hooks">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.mala520.life/2020/03/18/%E6%8B%A5%E6%8A%B1React-Hooks/hooks-1.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.mala520.life/2020/03/18/æ‹¥æŠ±React-Hooks/"/>





<link rel="stylesheet" href="/js/prism/prism.css">

  <title>æ‹¥æŠ± React Hooks ï¼ˆä¸€ï¼‰åŸºç¡€ | Live and learn</title>
  








<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Live and learn</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.mala520.life/2020/03/18/%E6%8B%A5%E6%8A%B1React-Hooks/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç¥è¿">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/sgj.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Live and learn">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">æ‹¥æŠ± React Hooks ï¼ˆä¸€ï¼‰åŸºç¡€</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2020-03-18T14:16:43+08:00">
                2020-03-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/React/" itemprop="url" rel="index">
                    <span itemprop="name">React</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="React-Hooks-èµ·æº"><a href="#React-Hooks-èµ·æº" class="headerlink" title="React Hooks èµ·æº"></a>React Hooks èµ·æº</h1><ul>
<li>React ä¸€ç›´éƒ½æå€¡ä½¿ç”¨å‡½æ•°å¼ç»„ä»¶ã€‚æ›´è½»ä¾¿ï¼Œæ›´ä¼˜é›…ï¼Œæ€§èƒ½æ›´ä½³ã€‚å‡½æ•°å¼ç»„ä»¶åˆç§°<strong>æ— çŠ¶æ€ç»„ä»¶(FSC)</strong>ã€‚</li>
<li>ä»¥å‰ï¼Œéœ€è¦ä½¿ç”¨ <code>state</code> ï¼Œç”Ÿå‘½å‘¨æœŸç­‰React ç‰¹æ€§ï¼Œå¿…é¡»é‡æ„ä¸º class ç»„ä»¶ã€‚</li>
<li><code>Hooks</code> æ˜¯ React 16.8 æ–°å¢çš„ç‰¹æ€§ï¼Œå®ƒå¯ä»¥è®©ä½ åœ¨ä¸ç¼–å†™ <code>class</code> çš„æƒ…å†µä¸‹ä½¿ç”¨ <code>state</code> ä»¥åŠå…¶ä»–çš„ React ç‰¹æ€§ã€‚</li>
<li>ç°åœ¨ï¼Œä½ å¯ä»¥ç›´æ¥åœ¨ç°æœ‰çš„å‡½æ•°å¼ç»„ä»¶ä¸­ä½¿ç”¨ <code>Hooks</code>ï¼Œè€Œæ— é¡»é‡æ„ä¸º class ç»„ä»¶ã€‚</li>
<li>å…¨æ–°çš„æ€ç»´æ–¹å¼ã€‚no magic, just javascript and some rulesã€‚</li>
</ul>
<img src="/2020/03/18/%E6%8B%A5%E6%8A%B1React-Hooks/hooks-1.jpg" class="" title="hooksèµ·æº">

<h1 id="ç±»ç»„ä»¶è¢«è¯Ÿç—…"><a href="#ç±»ç»„ä»¶è¢«è¯Ÿç—…" class="headerlink" title="ç±»ç»„ä»¶è¢«è¯Ÿç—…"></a>ç±»ç»„ä»¶è¢«è¯Ÿç—…</h1><ul>
<li>ç±»(ç´¯)ï¼šè‡ªjså¼€å¤©è¾Ÿåœ°ï¼Œå°±æ˜¯é¢å‘å‡½æ•°å¼ç¼–ç¨‹(FP), é¢å‘å¯¹è±¡ç¼–ç¨‹(OOP)ä¸ºä½•ç‰©ã€‚çƒ¦äººçš„æ„é€ å‡½æ•°ã€‚superæ˜¯ä»€ä¹ˆï¼Ÿâ€¦â€¦</li>
<li>thisç»‘å®šï¼šç±»æ–¹æ³•ä¸ä¼šè‡ªåŠ¨ç»‘å®š this åˆ°å®ä¾‹ä¸Šã€‚ç°æœ‰å››ç§<code>bind</code>æ–¹å¼ã€‚ä¸ä¼˜é›…ï¼Œæ˜“å‡ºé”™ï¼Œ<code>bind</code>è¿˜å½±å“æ€§èƒ½ï¼ˆä½¿ç”¨ç®­å¤´å‡½æ•°åæœ‰æ‰€æ”¹å–„ï¼‰ã€‚</li>
<li>setState(): å¼‚æ­¥æ›´æ–°æœºåˆ¶ï¼Œ<code>state</code>æµ…åˆå¹¶æœºåˆ¶ã€‚ä¸ç†è§£è¿™äº›æ¦‚å¿µï¼Œå¾ˆå®¹æ˜“è¸©å‘ã€‚</li>
<li>ç”Ÿå‘½å‘¨æœŸè€¦åˆï¼šæ¯ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•é€šå¸¸åŒ…å«ä¸€å †ä¸ç›¸å…³çš„é€»è¾‘ï¼›ä¸åŒç”Ÿå‘½å‘¨æœŸä¸­çš„é€»è¾‘åˆæœ‰å…³è”ã€‚</li>
</ul>
<p>ä¸‹é¢ç»„ä»¶æ¥è‡ªå®é™…é¡¹ç›®ï¼Œç»è¿‡ç®€åŒ–å’Œå¾®è°ƒï¼ˆæ–¹ä¾¿æ¼”ç¤ºå’Œç›´è§‚æ„Ÿå—ï¼‰ï¼ŒåŸºæœ¬ä¸Šæš´éœ²å‡ºäº†ä¸Šé¢æ‰€æœ‰é—®é¢˜ã€‚ä¸šåŠ¡é€»è¾‘ä¸¥è°¨æ€§ä¸ç”¨æ¨æ•²ï¼š</p>
<pre><code class="language-jsx">class NumberInput extends React.Component {
  constructor(props) {
    // ä¸ºä»€ä¹ˆå¿…é¡»superï¼Œä¸ä¼ propsä¼šæ€æ ·
    super(props)
    this.state = {
      focus: false
    }
    this.tradingpwd = &#39;&#39;
    // ç¬¬ä¸€ç§bindï¼Œå®˜æ–¹æ¨è
    ;[&#39;onBlur&#39;].forEach(method =&gt; {
      this[method] = this[method].bind(this)
    })
  }
  // ä¸‹é¢ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸå¾—ç›¸äº’é…åˆï¼Œå®ç°æŸäº›åŠŸèƒ½
  componentDidMount() {
    this.tradingPwdHideInput.focus()
    // å¤„ç†æŸç±»å…¼å®¹é—®é¢˜
    let bodyTop = document.body.getBoundingClientRect().top
    const styleText = &#39;position: fixed; width: 100%; top: &#39; + bodyTop + &#39;px&#39;
    document.body.style.cssText = styleText
  }

  componentWillUnmount() {
    this.tradingPwdHideInput.blur()
    document.body.style.position = &#39;static&#39;
  }

  tradingPwdChange(e) {
    // ...
    this.tradingpwd = e.target.value
    this.props.inputChangeCallback(e.target.value)
    // ...
  }
  // ç¬¬äºŒç§bind
  onFocus = () =&gt; {
    this.setState({
      focus: true
    })
  }
  onBlur() {
    this.setState({
      focus: false
    })
  }

  render() {
    return (
      &lt;div className={classNames(&#39;NumberInput&#39;)}&gt;
        &lt;input
          type=&#39;tel&#39;
          ref={ref =&gt; {
            this.tradingPwdHideInput = ref
          }}
          id=&#39;tradingPwdHideInput&#39;
          /* ç¬¬ä¸‰ç§bind */
          onClick={() =&gt; {
            this.tradingPwdHideInput.focus()
          }}
          onBlur={ this.onBlur }
          onFocus={ this.onFocus }
          /* ç¬¬å››ç§bindï¼Œä¸æ¨èï¼Œåœ¨æ¯æ¬¡ render() æ–¹æ³•æ‰§è¡Œæ—¶ç»‘å®šç±»æ–¹æ³•ï¼Œæ¶ˆè€—æ€§èƒ½*/
          onChange={ this.tradingPwdChange.bind(this) }
        /&gt;
      &lt;/div&gt;
    )
  }
}</code></pre>
<blockquote>
<p><a href="https://github.com/tc39/proposal-class-fields" target="_blank" rel="noopener">proposal-class-fields</a> æ–°ææ¡ˆä¼šæ”¹å–„ä¸Šè¿°æƒ…å†µï¼Œç›®å‰å¤„äºç¬¬ä¸‰é˜¶æ®µã€‚</p>
</blockquote>
<p>éšç€ç±»ç»„ä»¶è¶‹äºå¤æ‚ï¼Œè¿˜æœ‰å…¶ä»–è¯Ÿç—…ï¼š</p>
<ul>
<li>éš¾æ‹†åˆ†ï¼Œæœ¬åœ°stateé€»è¾‘åˆ°å¤„éƒ½æ˜¯ï¼Œå½“ç»„ä»¶è¶Šæ¥è¶Šå¤æ‚ï¼Œæƒ³æ‹†åˆ†æ¯”è¾ƒéš¾ã€‚</li>
<li>çŠ¶æ€é€»è¾‘éš¾å¤ç”¨ï¼šéœ€è¦å¼•å…¥é«˜é˜¶ç‰¹æ€§è¿›è¡Œä»£ç é‡æ„ï¼Œéœ€è¦è°ƒæ•´ç»„ä»¶ç»“æ„ï¼Œæˆæœ¬é«˜ã€‚</li>
<li>æŠ½è±¡åœ°ç‹±ï¼šå¤§å‹Reactå¾€å¾€ä½¿ç”¨render props ï¼ŒHOCï¼ŒContext ç­‰é«˜é˜¶ç‰¹æ€§ï¼Œå½¢æˆå¤§é‡åŒ…è£…ç»„ä»¶ï¼ˆwrapping componentsï¼‰ã€‚å±‚çº§å†—ä½™ï¼Œé€»è¾‘éš¾è¿½è¸ªã€‚</li>
</ul>
<p>æ·±åº¦åŒ…è£…çš„ç»„ä»¶é•¿è¿™æ ·ï¼š</p>
<pre><code class="language-jsx">import { compose } from &#39;recompose&#39;;
import { withRouter } from &#39;react-router-dom&#39;;
function App({ history, state, dispatch }) {
  return (
    &lt;ThemeContext.Consumer&gt;
      {theme =&gt;
        &lt;Content theme={theme}&gt;
          ... 
        &lt;/Content&gt;
      }
    &lt;/ThemeContext.Consumer&gt;
  );
}
export default compose(
  withRouter,
  withReducer(reducer, initialState)
)(App);</code></pre>
<p>ç¡®å®å¾ˆæŠ½è±¡ã€‚è¿™æ˜¯ React ä¸­å…¸å‹çš„<strong>æŠ½è±¡åœ°ç‹±ï¼ˆAbstraction hellï¼‰</strong>é—®é¢˜ï¼Œä¹Ÿå«<strong>åŒ…è£…åœ°ç‹±ï¼ˆThe wrapper hellï¼‰</strong>ã€‚</p>
<h1 id="Hooks-ä¼˜è¶Šæ€§"><a href="#Hooks-ä¼˜è¶Šæ€§" class="headerlink" title="Hooks ä¼˜è¶Šæ€§"></a>Hooks ä¼˜è¶Šæ€§</h1><p><code>Hooks</code> å¼•å…¥çš„ä¸€ä¸ªé‡è¦çš„åŸå› ï¼Œå°±æ˜¯ç±»ç»„ä»¶å­˜åœ¨ç€ç§ç§è¯Ÿç—…ã€‚é‚£ä»–å¿…ç„¶å­˜åœ¨ä¸€äº›ä¼˜è¶Šæ€§ã€‚</p>
<p>åœ¨è¯´æ˜è¿™äº›ä¼˜è¶Šæ€§ä¹‹å‰ï¼Œå…ˆäº†è§£ä¸€ä¸ªæ¦‚å¿µï¼š</p>
<blockquote>
<p><strong>å‰¯ä½œç”¨</strong>ï¼šReact ä¸­ä¸»è¦æŒ‡é‚£äº›æ²¡æœ‰å‘ç”Ÿåœ¨æ•°æ®å‘è§†å›¾ï¼ˆM-Vï¼‰è½¬æ¢è¿‡ç¨‹ä¸­çš„é€»è¾‘ï¼Œå¦‚ <code>Ajax</code> è¯·æ±‚ã€è®¿é—®åŸç”Ÿ <code>DOM</code> å…ƒç´ ã€æœ¬åœ°æŒä¹…åŒ–ç¼“å­˜ã€ç»‘å®š/è§£ç»‘äº‹ä»¶ã€æ·»åŠ /å–æ¶ˆè®¢é˜…ã€è®¾ç½®å®šæ—¶å™¨ã€è®°å½•æ—¥å¿—ç­‰ã€‚</p>
</blockquote>
<p>Hooks çš„ä¼˜è¶Šæ€§ï¼š</p>
<ul>
<li>å‡½æ•°å¼ç¼–ç¨‹ï¼šNo <code>class</code>, No <code>super</code>, No <code>this</code>ã€‚å¯¹äºä¸äº†è§£ <code>OOP</code> çš„ React åˆå­¦è€…æ›´å‹å¥½ã€‚</li>
<li>æœ‰çŠ¶æ€é€»è¾‘æ˜“å¤ç”¨ï¼šå¯ä»¥é€šè¿‡ <code>Custom Hook</code>ï¼ˆåé¢è®²è§£ï¼‰é‡æ„ï¼Œè€Œä¸ç”¨ä¿®æ”¹ç»„ä»¶ç»“æ„ã€‚</li>
<li>æ˜“æ‹†åˆ†ï¼šçŠ¶æ€ç®¡ç†å’Œå‰¯ä½œç”¨ç®¡ç†æ¾è€¦åˆï¼ŒåŸå­æ€§å¼ºã€‚å¾ˆå®¹æ˜“å°†ä¸€äº›ç›¸å…³è”çš„é€»è¾‘æ‹†åˆ†æˆæ›´å°çš„å‡½æ•°ã€‚</li>
<li>å¯é€æ­¥å¼•å…¥ï¼š<code>Hooks</code> å‘åå…¼å®¹ï¼Œä¸ç°æœ‰ä»£ç å¯å¹¶è¡Œå·¥ä½œï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€æ­¥é‡‡ç”¨å®ƒä»¬ã€‚</li>
<li>å‰¯ä½œç”¨åˆ†ç»„ï¼šå¾ˆå¤šå‰¯ä½œç”¨é€»è¾‘åˆ†æ•£åœ¨ç±»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­ã€‚è€Œ <code>Hooks</code> å¯ä»¥å°†æ¯ä¸ªå‰¯ä½œç”¨çš„è®¾ç½®å’Œæ¸…ç†å°è£…åœ¨ä¸€ä¸ªå‡½æ•°ä¸­ã€‚</li>
<li>å‰¯ä½œç”¨åˆ†ç¦»ï¼šå‰¯ä½œç”¨æ“ä½œéƒ½åœ¨é¡µé¢æ¸²æŸ“ä¹‹åã€‚</li>
</ul>
<h1 id="æŠ›å¼ƒç±»ç»„ä»¶ï¼Ÿ"><a href="#æŠ›å¼ƒç±»ç»„ä»¶ï¼Ÿ" class="headerlink" title="æŠ›å¼ƒç±»ç»„ä»¶ï¼Ÿ"></a>æŠ›å¼ƒç±»ç»„ä»¶ï¼Ÿ</h1><p>æ—¢ç„¶ <code>Hooks</code> å­˜åœ¨è¿™ä¹ˆå¤šä¼˜è¶Šæ€§ã€‚é‚£æ˜¯ä¸æ˜¯å°±åˆ°äº†æŠ›å¼ƒ class ç»„ä»¶çš„æ—¶å€™äº†ã€‚</p>
<p>å¯¹æ­¤ï¼Œå®˜æ–¹è¯´ï¼š</p>
<ul>
<li>æ–°ç‰ˆæœ¬ä¾ç„¶æ”¯æŒ <code>class</code> ç›¸å…³APIï¼Œåœ¨ç›¸å½“ä¸€æ®µæ—¶æœŸå†…ï¼Œclass ç»„ä»¶ å’Œ Hooks ç»„ä»¶å¹¶å­˜ã€‚</li>
<li>å‘åå…¼å®¹ï¼Œæ˜¯åŠ æ³•ã€‚æ³¨æ„ï¼Œæ˜¯å‡½æ•°ç»„ä»¶çš„åŠ æ³•ï¼Œå³ <code>Hooks</code> åªèƒ½ç”¨åœ¨å‡½æ•°ç»„ä»¶ä¸­ã€‚</li>
<li>æ¨èä½¿ç”¨ å‡½æ•°ç»„ä»¶ + <code>Hooks</code>ã€‚</li>
</ul>
<p>ä¸ªäººè§‰å¾—ï¼š</p>
<ul>
<li><strong>å½“ä¸‹</strong>ï¼šä¸æŠ›å¼ƒï¼Œä¸æ”¾å¼ƒã€‚class ç»„ä»¶å°†æˆ‘ä»¬å¸¦åˆ°äº† OOP çš„ä¸–ç•Œï¼ŒOOPåœ¨ç¼–ç¨‹ç•Œä¸¾è¶³è½»é‡ï¼Œå…¶æ€æƒ³æ˜¯å€¼å¾—å­¦ä¹ çš„ã€‚å³ä¾¿ class ç»„ä»¶å·²ç„¶æˆä¸ºä¸€ç§å†å²äº§ç‰©ï¼Œä½†ä»–çš„å­˜é‡å·¨å¤§ï¼Œä¾ç„¶éœ€è¦å»ç»´æŠ¤ï¼Œå»æ…¢æ…¢æ¶ˆåŒ–ã€‚</li>
<li><strong>æœªæ¥</strong>ï¼šæœ‰å¯èƒ½å¼ƒç”¨ class ç»„ä»¶åŠå…¶ç”Ÿå‘½å‘¨æœŸã€‚ä¸€æ–¹é¢ï¼Œå‰ç«¯çš„ä¸–ç•Œæœ¬æ¥å˜åŒ–å°±å¿«ã€‚å¦ä¸€æ–¹é¢ï¼Œclass ç»„ä»¶ç¡®å®å­˜åœ¨ä¸€äº›å¼Šç«¯ã€‚éšç€ <code>Hooks</code>çš„ä¸æ–­æˆç†Ÿï¼ˆæˆ–æ–°çš„æŠ€æœ¯è¯ç”Ÿï¼‰ï¼Œ ä½¿å¾—å¼€å‘æ•ˆç‡ï¼Œä»£ç å¯è¯»æ€§ï¼Œç»´æŠ¤æ€§ï¼Œæ€§èƒ½ç­‰ç»¼åˆä¼˜åŠ¿æ¯”è¾ƒæ˜æ˜¾çš„æ—¶å€™ï¼Œå¼ƒç”¨æ˜¯å¿…ç„¶ã€‚</li>
</ul>
<p>æ‰€ä»¥ï¼š</p>
<ul>
<li>å¯¹äº React è€å¸æœºï¼šæ‹¥æŠ±Hooksï¼Œæ˜¯æ‹¥æŠ±å˜åŒ–ã€‚è¿™ä¸ªå˜åŒ–ï¼Œæ˜¯åŠ æ³•ï¼Œæ˜¯å­¦ä¹ æ–°çš„APIï¼Œæ–°çš„æŠ€èƒ½ï¼Œæ–°çš„æ€æƒ³ã€‚</li>
<li>å¯¹äº React æ–°æ‰‹ï¼šæ‹¥æŠ±Hooksï¼Œé™ä½äº†å­¦ä¹ é—¨æ§›ï¼Œå¯ä»¥æ›´å¿«å…¥é—¨ã€‚ä½†æ˜¯ç±»ç»„ä»¶ä¹Ÿéå¸¸æœ‰å¿…è¦å»äº†è§£ï¼Œç†è§£ã€‚çŸ¥å·±çŸ¥å½¼ï¼Œé‡æ„ä¸æ®†ã€‚</li>
</ul>
<p>è¯´äº†è¿™ä¹ˆå¤šï¼Œæ¥ï¼Œæˆ‘ä»¬å…ˆæ¥å’Œè¿™äº› React Hooks çš„ API è§ä¸ªé¢ï¼š</p>
<p>åŸºç¡€ Hook</p>
<ul>
<li>useState</li>
<li>useEffect</li>
</ul>
<p>å…¶ä»– Hook</p>
<ul>
<li>useContext</li>
<li>useReducer</li>
<li>useCallback</li>
<li>useMemo</li>
<li>useRef</li>
<li>useImperativeHandle</li>
<li>useLayoutEffect</li>
<li>useDebugValue</li>
<li>â€¦ è¿˜ä¼šå¢åŠ </li>
</ul>
<p>æ˜¯ä¸æ˜¯æœ‰ç‚¹å¤šï¼Œå…¶å®<code>useState</code> <code>useEffect</code> è¿™ä¸¤ä¸ªå·²ç»èƒ½åº”ä»˜å¤šæ•°åœºæ™¯äº†ã€‚Letâ€˜s goğŸ‘‡</p>
<h1 id="useState-hook"><a href="#useState-hook" class="headerlink" title="useState hook"></a>useState hook</h1><ul>
<li>åŠŸèƒ½ï¼šåœ¨å‡½æ•°ç»„ä»¶ä¸­ç”¨æ¥è¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼Œåˆ›å»º<strong>ä¸€äº›</strong>æœ¬åœ° stateã€‚</li>
<li>APIï¼š<code>const [currentState, setFunction] = useState(initialState);</code>ã€‚ä¼ ä¸€ä¸ªå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ï¼ˆåŒ…å«ä¸¤ä¸ªå€¼ï¼‰- ä¸‰è¦ç´ ã€‚</li>
<li><code>initialState</code>ï¼šå‚æ•°ï¼Œstate åˆå§‹å€¼ã€‚å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼š Stringï¼ŒObjectï¼ŒArrayï¼ŒBoolï¼ŒNumberç­‰ã€‚</li>
<li><code>currentState</code>ï¼šè¿”å›å€¼ï¼Œstate å½“å‰æœ€æ–°å€¼ã€‚å¯è‡ªä¸»å‘½åã€‚</li>
<li><code>setFunction</code>ï¼šè¿”å›å€¼ï¼Œstate æ›´æ–°å‡½æ•°ã€‚å¯è‡ªä¸»å‘½åã€‚ä½ å¯ä»¥åœ¨ä»»æ„ä½ç½®è°ƒç”¨ï¼Œæ¥æ”¹å˜ state çš„å€¼ã€‚æ¯æ¬¡è°ƒç”¨ï¼Œä¼šè§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼ˆè¿™ä¹Ÿæ˜¯è¿”å›å€¼ç”¨ <code>const</code> é <code>let</code> çš„åŸå› ï¼‰ã€‚</li>
<li>ç‰¹ç‚¹ï¼šå¯ä½¿ç”¨å¤šä¸ª<code>useState</code>ï¼Œå½¼æ­¤ç‹¬ç«‹ã€‚è€Œç±»ç»„ä»¶ï¼Œåªæœ‰ä¸€ä¸ª stateï¼Œæ¯æ¬¡<code>setState</code> è¦è¿›è¡Œæµ…åˆå¹¶ï¼ˆå†…éƒ¨å®ç°ï¼‰ã€‚ </li>
</ul>
<p>è¿™ä¸ªAPIå¾ˆç®€å•ï¼Œè¯·çœ‹ä¸‹é¢ç¤ºä¾‹(24è¡Œä»£ç )ï¼š</p>
<pre><code class="language-jsx">import React, { useState } from &#39;react&#39;;
function Form() {
  // ES6 è§£æ„
  const [name, setName] = useState(&#39;Mary&#39;);              // State å˜é‡ 1
  const [surname, setSurname] = useState(&#39;Poppins&#39;);     // State å˜é‡ 2
  const [width, setWidth] = useState(window.innerWidth); // State å˜é‡ 3

  function handleNameChange(e) {
    setName(e.target.value);
  }

  function handleSurnameChange(e) {
    setSurname(e.target.value);
  }

  return (
    &lt;&gt;
      &lt;input value={name} onChange={handleNameChange} /&gt;
      &lt;input value={surname} onChange={handleSurnameChange} /&gt;
      &lt;p&gt;Hello, {name} {surname}&lt;/p&gt;
      &lt;p&gt;Window width: {width}&lt;/p&gt;
    &lt;/&gt;
  );
}
export default Form;</code></pre>
<blockquote>
<p><code>&lt;&gt;&lt;/&gt;</code> æ˜¯ <code>React.Fragment</code> çš„ç®€å†™è¯­æ³•ã€‚</p>
</blockquote>
<p>ç”¨classç±»å®ç°çš„è¯ï¼ˆ31è¡Œä»£ç ï¼‰ï¼Œä¸Šè¿°ä»£ç ç›¸å½“äºï¼š</p>
<pre><code class="language-jsx">import React from &#39;react&#39;;
class Form extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      name: &#39;Mary&#39;,
      surname:&#39;Poppins&#39;,
      width: window.innerWidth
    };
  }
  handleNameChange = (e) =&gt; {
    this.setState({ name: e.target.value });
  }

  handleSurnameChange = (e) =&gt; {
    this.setState({ surname: e.target.value });
  }

  render() {
    const { name, surname, width } = this.state
    return (
      &lt;&gt;
        &lt;input value={name} onChange={ this.handleNameChange } /&gt;
        &lt;input value={surname} onChange={ this.handleSurnameChange } /&gt;
        &lt;p&gt;Hello, {name} {surname}&lt;/p&gt;
        &lt;p&gt;Window width: {width}&lt;/p&gt;
      &lt;/&gt;
    );
  }
}
export default Form;</code></pre>
<h2 id="useStateã€Œç²’åº¦ã€é—®é¢˜"><a href="#useStateã€Œç²’åº¦ã€é—®é¢˜" class="headerlink" title="useStateã€Œç²’åº¦ã€é—®é¢˜"></a>useStateã€Œç²’åº¦ã€é—®é¢˜</h2><p>çœ‹åˆ°è¿™é‡Œï¼Œå¯¹äºå†™è¿‡classç»„ä»¶çš„æˆ‘ä»¬ï¼Œå¾ˆå®¹æ˜“äº§ç”Ÿä¸€ä¸ªç–‘é—®ã€‚ å®é™…å·¥ä½œä¸­ï¼Œä¸€ä¸ªç±»ç»„ä»¶çš„ <code>this.state</code> ä¸­å¾€å¾€æœ‰åå‡ é¡¹ï¼Œç”¨ <code>Hooks</code> æ”¹å†™çš„è¯éš¾é“è¦å†™åå‡ ä¸ª <code>useState</code> ä¹ˆï¼Ÿ</p>
<blockquote>
<p>å¯¹äºè¿™ä¸ªå¸¸è§é—®é¢˜ï¼Œå®˜æ–¹æ–‡æ¡£æœ‰<a href="http://react.html.cn/docs/hooks-faq.html#should-i-use-one-or-many-state-variables" target="_blank" rel="noopener">è§£ç­”</a>ã€‚</p>
</blockquote>
<p>æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œæ€»ç»“ä¸‹æ¥ï¼Œæœ‰å‡ ç‚¹ï¼š</p>
<ul>
<li>å»ºè®®å°† <code>state</code> åˆ†å‰²ä¸ºå¤šä¸ª <code>useState</code>ã€‚ç²’åº¦æ›´ç»†ï¼Œæ›´æ˜“äºç®¡ç†ï¼Œæ›´å¥½å¤ç”¨ã€‚</li>
<li>å¯èƒ½ä¸€èµ·æ”¹å˜çš„ <code>state</code> å¯åˆå¹¶æˆä¸€ä¸ª<code>useState</code>ï¼ˆ æ¯”å¦‚<code>Dom</code>å…ƒç´ çš„ <code>top</code> <code>left</code>ï¼‰ã€‚</li>
<li>å½“ <code>state</code> é€»è¾‘è¶‹äºå¤æ‚ï¼Œå»ºè®®ä½¿ç”¨ <code>reducer</code> æˆ– <code>Custom Hook</code> ç®¡ç†ï¼ˆ<strong>åé¢ä»‹ç»</strong>ï¼‰ã€‚</li>
</ul>
<p>å½“ç»„ä»¶çš„ <code>state</code> å¾ˆå¤šçš„æ—¶å€™ï¼Œä¸ºäº†æé«˜ä»£ç çš„å¯è¯»æ€§ï¼Œä¹Ÿå¯ä»¥æŠŠé€»è¾‘ç›¸å…³çš„ä¸€äº› <code>state</code> åˆå¹¶ä¸ºä¸€ä¸ª <code>useState</code>ï¼ˆ æ¯”å¦‚åˆ†é¡µå‚æ•° ï¼‰ã€‚ä½†è¿™äº› <code>state</code> å¹¶ä¸æ˜¯ä¸€èµ·æ”¹å˜çš„ï¼Œæ‰€ä»¥å½“å…¶ä¸­ä¸€ä¸ª <code>state</code> æ”¹å˜ï¼Œè°ƒç”¨å¯¹åº”çš„ <code>setFunction</code> çš„æ—¶å€™ã€‚ä½ éœ€è¦åš<strong>å¯¹è±¡åˆå¹¶</strong>(ä¸åˆå¹¶å°±ä¸¢äº†)ï¼š</p>
<pre><code class="language-jsx">const [ pageData, setPageDate ] = useState({ pageSize: 20, current: 1, total:0, })

const onPageChange = current =&gt; {
  // å¸¸è§„æ“ä½œ
  setPageDate( Object.assign( {}, pageData, { current } ) ï¼‰
  // å®˜æ–¹å»ºè®®
  setPageDate(currentPageData =&gt; ({ ...currentPageData, current}));
}
</code></pre>
<blockquote>
<p>çŸ¥è¯†ç‚¹ï¼šè°ƒç”¨ useState çš„æ›´æ–°å‡½æ•°æ—¶ï¼Œå¯ä»¥ä¼ ä¸€ä¸ªç®­å¤´å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„å‚æ•°æ˜¯å½“å‰æœ€æ–°çš„ stateï¼Œ è¿”å›å€¼æ˜¯è¦è®¾ç½®çš„ state ã€‚</p>
</blockquote>
<h1 id="useEffect-hook"><a href="#useEffect-hook" class="headerlink" title="useEffect hook"></a>useEffect hook</h1><p>API å¯æŠ½è±¡ä¸º: <code>useEffect(arrowFunction, [depsArr])</code> </p>
<ul>
<li><code>arrowFunction</code>: å¿…é¡»ã€‚æ‰§è¡Œå‡½æ•°ï¼Œæ‰§è¡Œå‰¯ä½œç”¨æ“ä½œã€‚å®ƒå†³å®šäº†åšä»€ä¹ˆã€‚</li>
<li><code>depsArr</code>: éå¿…é¡»ã€‚ä¸€ä¸ªä¾èµ–é¡¹æ•°ç»„ã€‚å®ƒå†³å®šäº†ä»€ä¹ˆæ—¶å€™åšï¼ˆä¸‹é¢ç¤ºä¾‹ä¸­ä»‹ç»ï¼‰ã€‚</li>
</ul>
<p>æ ¹æ®å®é™…æƒ…å†µï¼Œå¯ç»†åˆ†ä¸ºä¸‰ç§ï¼š</p>
<pre><code class="language-jsx">// ç¬¬ä¸€ç§
// æœ€åŸºç¡€çš„ï¼Œåªæœ‰ç®­å¤´å‡½æ•°ã€‚æ²¡æœ‰ä¾èµ–é¡¹ï¼Œæ‰€ä»¥ç»„ä»¶æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šæ‰§è¡Œã€‚
// ç›¸å½“äº  componentDidMount + componentDidUpdate
useEffect(() =&gt; { 
  //side-effect 
})
// ç¬¬äºŒç§
// æœ‰ä¾èµ–é¡¹ï¼Œæ˜¯ä¸€ä¸ªç©ºæ•°ç»„ï¼Œå› ä¸ºå®ƒæ°¸è¿œä¸ä¼šå˜ï¼Œæ‰€ä»¥åªä¼šé¦–æ¬¡æ‰§è¡Œã€‚
// ç›¸å½“äº componentDidMount
useEffect(() =&gt; { 
  //side-effect 
}, [])
// ç¬¬ä¸‰ç§
// æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¸”éç©ºæ•°ç»„ã€‚é¦–æ¬¡æ¸²æŸ“ä¼šæ‰§è¡Œã€‚é‡æ–°æ¸²æŸ“æ—¶ï¼Œåªæœ‰å½“ä¾èµ–é¡¹çš„å€¼æ”¹å˜äº†æ‰ä¼šæ‰§è¡Œã€‚
useEffect(() =&gt; { 
  //side-effect 
}, [...state])</code></pre>
<blockquote>
<p>ç›¸å½“æ˜¯ <code>==</code> è€Œé  <code>===</code>ã€‚</p>
</blockquote>
<p>æ€»ç»“ä¸‹æ¥ï¼š</p>
<ul>
<li>åŠŸèƒ½ï¼šç®¡ç† React å‡½æ•°ç»„ä»¶çš„å‰¯ä½œç”¨ï¼Œèµ‹äºˆç”Ÿå‘½å‘¨æœŸèƒ½åŠ›ã€‚</li>
<li>æ€ä¹ˆç®¡ï¼šç»„ä»¶æ¯æ¬¡æ¸²æŸ“åˆ°å±å¹•ä¹‹åï¼Œæ ¹æ®ä¾èµ–é¡¹çš„æƒ…å†µåˆ¤æ–­æ˜¯å¦è°ƒç”¨æ‰§è¡Œå‡½æ•°ã€‚</li>
<li>äºŒè¦ç´ ï¼šæ‰§è¡Œå‡½æ•°ï¼Œä¾èµ–é¡¹ã€‚</li>
<li>æ¸…ç†æœºåˆ¶ï¼šä½ å¯ä»¥åœ¨æ‰§è¡Œå‡½æ•°ä¸­è¿”å›å¦ä¸€ä¸ªå‡½æ•°-<strong>æ¸…ç†å‡½æ•°</strong>ï¼Œæ¸…ç†å‡½æ•°ä¼šåœ¨ç»„ä»¶å¸è½½çš„æ—¶å€™ï¼Œä¼šåœ¨ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œä¸”useEffectçš„ä¾èµ–é¡¹å€¼æ”¹å˜çš„æ—¶å€™è°ƒç”¨ã€‚èµ·åˆ°äº† class ç»„ä»¶ä¸­<code>componentWillUnmount</code>çš„ä½œç”¨, åç»­ä¼šåœ¨åœºæ™¯å®ä¾‹ä¸­ä»‹ç»ã€‚</li>
<li>ä½¿ç”¨ä¸Šï¼šå’Œ <code>useState</code> ä¸€æ ·ï¼Œå¯ä½¿ç”¨å¤šä¸ªã€‚å»ºè®®ä¸€ä¸ªå‰¯ä½œç”¨å¯¹åº”ä¸€ä¸ª <code>useEffect</code>ã€‚</li>
</ul>
<p>æ ¹æ®å‰¯ä½œç”¨æ˜¯å¦éœ€è¦æ¸…ç†ï¼Œ<code>useEffect</code> å¯åˆ†ä¸º <strong>ä¸éœ€è¦æ¸…ç†çš„</strong> <code>useEffect</code>ï¼Œå’Œ <strong>éœ€è¦æ¸…ç†çš„</strong> <code>useEffect</code>ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬åˆ†åˆ«é€šè¿‡ä¸€äº›ç¤ºä¾‹æ¥ç›´è§‚çš„æ„Ÿå—ä¸€ä¸‹ã€‚</p>
<h2 id="ä¸éœ€è¦æ¸…ç†çš„åœºæ™¯"><a href="#ä¸éœ€è¦æ¸…ç†çš„åœºæ™¯" class="headerlink" title="ä¸éœ€è¦æ¸…ç†çš„åœºæ™¯"></a>ä¸éœ€è¦æ¸…ç†çš„åœºæ™¯</h2><p>æœ‰æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨ React æ¸²æŸ“é¡µé¢ä¹‹åè¿è¡Œä¸€äº›é¢å¤–çš„ä»£ç ã€‚ ç½‘ç»œè¯·æ±‚ã€æ‰‹åŠ¨ä¿®æ”¹DOM å’Œæ—¥å¿—è®°å½•éƒ½æ˜¯ä¸éœ€è¦æ¸…ç† å‰¯ä½œç”¨ çš„å¸¸è§ä¾‹å­ã€‚å¯ä»¥è¿™ä¹ˆè¯´ï¼Œæˆ‘ä»¬è¿è¡Œå®ƒä»¬ï¼Œç„¶åå¯ä»¥é©¬ä¸Šå¿˜è®°å®ƒä»¬ã€‚</p>
<p>å°±æ‹¿å®˜ç½‘çš„ä¾‹å­æ¥è¯´ï¼Œä¸€ä¸ªè®¡æ•°å™¨ç»„ä»¶ï¼Œè®¡æ•°å‘ç”Ÿæ”¹å˜ä»¥åï¼Œæ›´æ–° <code>Dom</code> æ ‡é¢˜ã€‚ç±»ç»„ä»¶æ˜¯è¿™æ ·å®ç°çš„ï¼š</p>
<pre><code class="language-jsx">
class Example extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      count: 0
    };
  }

  componentDidMount() {
    document.title = `You clicked ${this.state.count} times`; 
  }

  componentDidUpdate() {
    document.title = `You clicked ${this.state.count} times`;
  }

  render() {
    return (
      &lt;div&gt;
        &lt;p&gt;You clicked {this.state.count} times&lt;/p&gt;
        &lt;button onClick={() =&gt; this.setState({ count: this.state.count + 1 })}&gt;
          Click me
        &lt;/button&gt;
      &lt;/div&gt;
    );
  }
}</code></pre>
<p>ç”¨ <code>useEffect</code> å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="language-jsx">import { useState, useEffect } from &#39;react&#39;;

function Example() {
  const [count, setCount] = useState(0);
  // ç¬¬ä¸€ç§useEffect
  useEffect(() =&gt; {
    document.title = `You clicked ${count} times`;
  });

  return (
    &lt;div&gt;
      &lt;p&gt;You clicked {count} times&lt;/p&gt;
      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;
        Click me
      &lt;/button&gt;
    &lt;/div&gt;
  );
}</code></pre>
<blockquote>
<p>è§„åˆ™ï¼šæ¯ä¸€æ¬¡æ¸²æŸ“åéƒ½å»è¿è¡Œæ‰€æœ‰çš„ effects å¯èƒ½å¹¶ä¸é«˜æ•ˆã€‚ï¼ˆå¹¶ä¸”åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œå®ƒå¯èƒ½ä¼šå¯¼è‡´æ— é™å¾ªç¯ã€‚ï¼‰â€“ Dan Abramov</p>
</blockquote>
<p>è¿™æ¡è§„åˆ™å‘Šè¯‰æˆ‘ä»¬ï¼Œåœ¨å†™æ— ä¾èµ–çš„ <code>useEffect</code> çš„æ—¶å€™ï¼Œå¤šä¸€ç‚¹æ€è€ƒã€‚ä¸Šé¢ä»£ç ç°åœ¨çœ‹æ²¡æœ‰é—®é¢˜ï¼Œåç»­å¢åŠ äº†å…¶ä»– state å’ŒåŠŸèƒ½ä»¥åï¼Œè¿™ä¸ª <code>useEffect</code> å°±ä¸é«˜æ•ˆäº†ï¼Œå¯æ”¹å†™ä¸ºï¼š</p>
<pre><code class="language-jsx">import { useState, useEffect } from &#39;react&#39;;

function Example() {
  const [count, setCount] = useState(0);
  useEffect(() =&gt; {
    document.title = `You clicked ${count} times`;
  },[count]);// çœ‹è¿™é‡Œ
  return (
    &lt;div&gt;
      &lt;p&gt;You clicked {count} times&lt;/p&gt;
      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;
        Click me
      &lt;/button&gt;
    &lt;/div&gt;
  );
}</code></pre>
<h2 id="éœ€è¦æ¸…ç†çš„åœºæ™¯"><a href="#éœ€è¦æ¸…ç†çš„åœºæ™¯" class="headerlink" title="éœ€è¦æ¸…ç†çš„åœºæ™¯"></a>éœ€è¦æ¸…ç†çš„åœºæ™¯</h2><p>æœ‰ä¸€äº›åœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦åšå‰¯ä½œç”¨çš„æ¸…ç†ï¼Œä¿è¯å¼•èµ·ä¸å¿…è¦å†…å­˜æ³„æ¼ã€‚æ¯”å¦‚ï¼Œæ‰‹åŠ¨ç»‘å®šäº‹ä»¶ï¼Œè®¢é˜…ï¼Œå®šæ—¶å™¨ç­‰ã€‚</p>
<p>ä»¥å®šæ—¶å™¨ä¸ºä¾‹ï¼Œè®©æˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªç§’è¡¨ç»„ä»¶ã€‚è¿™æ˜¯ä¸€ä¸ªå­¦ä¹ å’Œç†è§£ <code>useEffect</code> éå¸¸æœ‰æ„æ€çš„ä¾‹å­ã€‚</p>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬ç›´æ¥ç”¨ <code>Hooks</code> æ¥å®ç°ï¼š</p>
<pre><code class="language-jsx">import React, { useState, useEffect } from &#39;react&#39;;

function App() {
  // ç§’è¡¨å¼€å…³
  const [isOn, setIsOn] = useState(false);
  // è®¡æ•°
  const [timer, setTimer] = useState(0);

  useEffect(() =&gt; {
    let interval;
    //å¼€å…³æ‰“å¼€çš„æ—¶å€™æ‰æ‰§è¡Œ
    if (isOn) {
      // é€šè¿‡å®šæ—¶å™¨å¢åŠ è®¡æ•°
      interval = setInterval(
        () =&gt; setTimer(timer + 1),
        1000,
      );
    }
    // éœ€è¦æ¸…é™¤å®šæ—¶å™¨
    // ä¸æ¸…ç†ä¼šå¦‚ä½•ï¼Ÿcodesandboxä¸­å°è¯•ï¼Œé¡µé¢ç›´æ¥å¡æ­»
    return () =&gt; clearInterval(interval);
  }); 

  return (
    &lt;&gt;
      &lt;p&gt;{timer}&lt;/p&gt;

      {!isOn &amp;&amp; (
        &lt;button type=&quot;button&quot; onClick={() =&gt; setIsOn(true)}&gt;
          Start
        &lt;/button&gt;
      )}

      {isOn &amp;&amp; (
        &lt;button type=&quot;button&quot; onClick={() =&gt; setIsOn(false)}&gt;
          Stop
        &lt;/button&gt;
      )}
    &lt;/&gt;
  );
}

export default App;
</code></pre>
<p>è¿è¡Œä»£ç ï¼Œä½ ä¼šå‘ç°ï¼Œç§’è¡¨æ•ˆæœå®ç°äº†ã€‚ä½†æ˜¯ï¼ŒåŒæ ·çš„é”™è¯¯ï¼Œæ•…æ„çŠ¯äº†2æ¬¡ï¼šæ—¢ç„¶ç”¨äº†å®šæ—¶å™¨ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ effect æ¯æ¬¡æ‰§è¡Œã€‚è®©æˆ‘ä»¬æ¥åˆ†æä¸‹ä¸Šé¢ä»£ç çš„æ‰§è¡Œæµç¨‹ï¼š</p>
<ul>
<li>é¦–æ¬¡åŠ è½½ï¼šeffectæ‰§è¡Œã€‚å› ä¸º<code>isOn</code>æ˜¯<code>false</code>ï¼Œæ‰€ä»¥ å®šæ—¶å™¨ æ²¡æœ‰åˆ›å»ºã€‚</li>
<li>ç‚¹å‡» <code>start</code> æ‰“å¼€å¼€å…³(<code>setIsOn(true)</code>)ã€‚<code>isOn</code> è¿™ä¸ª state æ”¹å˜ï¼Œç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚effectå†æ¬¡æ‰§è¡Œï¼Œæ­¤æ—¶åˆ›å»ºå®šæ—¶å™¨ã€‚</li>
<li>å®šæ—¶å™¨ç”Ÿæ•ˆï¼Œ1ç§’åæ‰§è¡Œ <code>setTimer(timer + 1)</code>ï¼Œ<code>timer</code> è¿™ä¸ª state æ”¹å˜ï¼Œè§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼ˆå®šæ—¶å™¨ä¹Ÿä¼šæ¸…é™¤ï¼‰ã€‚effectå†æ¬¡æ‰§è¡Œï¼Œé‡æ–°åˆ›å»ºå®šæ—¶å™¨ã€‚</li>
<li>ä¸€ç›´é‡å¤ä¸Šé¢æ­¥éª¤ã€‚</li>
</ul>
<p>æœ‰æ²¡æœ‰å‘ç°é—®é¢˜ï¼Œå®šæ—¶å™¨åœ¨å¾ªç¯åˆ›å»ºï¼Œæ¸…é™¤ã€‚ç”¨ä»€ä¹ˆå®šæ—¶å™¨ï¼Œç”¨å»¶æ—¶å™¨ï¼ˆ<code>setTimeout</code>ï¼‰å¥½äº†ã€‚æœ€ç³Ÿç³•çš„æ˜¯ï¼Œå¦‚æœä½ å¿˜äº†æ¸…é™¤å®šæ—¶å™¨ï¼Œä¸å…‰è®¡æ•°ä¼šé”™ä¹±ï¼Œé¡µé¢ä¹Ÿä¼šå¥”æºƒã€‚</p>
<p>æ€ä¹ˆä¼˜åŒ–å‘¢ï¼ŸåŒæ ·çš„è§£å†³æ–¹æ¡ˆã€‚å¾ˆæ˜¾ç„¶ï¼Œæˆ‘ä»¬çš„ effect ä¾èµ– <code>isOn</code> è¿™ä¸ª stateï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠå®ƒä½œä¸º <code>useEffect</code> çš„ä¾èµ–é¡¹ï¼š</p>
<pre><code class="language-jsx">//...
useEffect(() =&gt; {
  let interval;
  if (isOn) {
    interval = setInterval(
      () =&gt; setTimer(timer + 1),
      1000,
    );
  }
  return () =&gt; clearInterval(interval);
  },[isOn]); // çœ‹è¿™é‡Œï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼
// ...</code></pre>
<p>è¿™æ ·æ˜¯ä¸æ˜¯å°±okäº†ï¼Ÿæ‹·è´ä»£ç åˆ° codeSandBox éªŒè¯ä¸€ä¸‹ã€‚whatï¼Ÿç‚¹å‡» <code>start</code> ï¼Œè®¡æ•°å™¨å¢åŠ åˆ° <code>1</code> ä»¥åä¸åŠ¨äº†ï¼ã€‚<br>é¡µé¢å¡æ­»äº†ä¹ˆï¼Ÿæˆ‘ä»¬å†åˆ†æä¸€ä¸‹æµç¨‹ï¼š</p>
<ul>
<li>é¦–æ¬¡åŠ è½½ï¼šeffect æ‰§è¡Œã€‚å› ä¸º <code>isOn</code> æ˜¯ <code>false</code>ï¼Œæ‰€ä»¥å®šæ—¶å™¨æ²¡æœ‰åˆ›å»ºã€‚</li>
<li>ç‚¹å‡» <code>start</code> æ‰“å¼€å¼€å…³ã€‚<code>isOn</code> æ”¹å˜ï¼Œç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚effect çš„ä¾èµ–é¡¹ <code>isOn</code> ä¹Ÿæ”¹å˜äº†ï¼Œeffect å†æ¬¡æ‰§è¡Œã€‚æ­¤æ—¶ï¼Œ<code>isOn</code> æ˜¯ <code>true</code>ï¼Œå®šæ—¶å™¨åˆ›å»ºã€‚</li>
<li>å®šæ—¶å™¨ç”Ÿæ•ˆï¼Œ1ç§’åæ‰§è¡Œ <code>setTimer(timer + 1)</code>ï¼Œ<code>timer</code> æ”¹å˜ï¼Œè§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚æ³¨æ„äº†ï¼Œæ­¤æ—¶ effect çš„ä¾èµ–é¡¹<code>isOn</code> å¹¶æ²¡æœ‰æ”¹å˜ï¼Œæ‰€ä»¥å®šæ—¶å™¨åœ¨é‡æ–°æ¸²æŸ“åä¸ä¼šæ¸…é™¤ï¼Œeffect ä¹Ÿä¸ä¼šå†æ¬¡æ‰§è¡Œã€‚çœ‹ä¸Šå»è¿™å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œå®šæ—¶å™¨è¿˜åœ¨å·¥ä½œã€‚é‚£ä¸ºä»€ä¹ˆä¸€ç›´æ˜¯ <code>1</code> ã€‚</li>
</ul>
<blockquote>
<p>è§„åˆ™ï¼šReact çº¦å®š Effect æ‹¿åˆ°çš„æ€»æ˜¯å®šä¹‰å®ƒçš„é‚£æ¬¡æ¸²æŸ“ä¸­çš„ <code>props</code> å’Œ <code>state</code>ã€‚â€“ Dan Abramov<br>æˆ‘ä¹Ÿæ³¨æ„åˆ°ï¼Œä¸Šé¢çš„ä»£ç åœ¨ codeSandBox ä¸­æ‰§è¡Œä¼šçœ‹åˆ°ä¸€æ¡å‘Šè­¦ä¿¡æ¯ï¼š<code>React Hook useEffect has a missing dependency: &#39;timer&#39;. Either include it or remove the dependency array. You can also do a functional update &#39;setTimer(t =&gt; ...)&#39; if you only need &#39;timer&#39; in the &#39;setTimer&#39; call. (react-hooks/exhaustive-deps) -- eslint</code></p>
</blockquote>
<p>ç–‘æƒ‘è§£å¼€ã€‚è¿™å…¶å®å°±æ˜¯jså¸¸è§çš„<strong>é—­åŒ…</strong>ï¼Œä½ ä¹Ÿå¯ä»¥ç†è§£ä¸ºè¿™æ˜¯ <code>useEffect</code> çš„çº¦å®šã€‚è¿™ä¸ªéå¸¸éå¸¸é‡è¦ï¼Œåˆ’é‡ç‚¹ã€‚<br>ä¸Šé¢çš„å‘Šè­¦ä¿¡æ¯ï¼Œå·²ç»æ˜ç¡®çš„å‘Šè¯‰äº†æˆ‘ä»¬å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>åŠæ³•ä¸€ï¼š å¢åŠ ä¾èµ–é¡¹ <code>timer</code> ï¼Œè¿™æ ·<code>timer</code> æ”¹å˜ä¹Ÿä¼šè§¦å‘é‡æ–°æ¸²æŸ“ï¼Œç„¶å effect éƒ½ã€ä¼šå†æ¬¡æ‰§è¡Œï¼Œå®šæ—¶å™¨ä¼šæ‹¿åˆ°æ–°çš„ <code>timer</code>ã€‚</p>
<pre><code class="language-jsx">useEffect(() =&gt; {
  let interval;
  if (isOn) {
    interval = setInterval(
      () =&gt; setTimer(timer + 1),
      1000,
    );
  }
  return () =&gt; clearInterval(interval);
  },[isOn,timer]); // çœ‹è¿™é‡Œï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼</code></pre>
<blockquote>
<p>è§„åˆ™ï¼š æˆ‘é¼“åŠ±ä½ è¯šå®åœ°å‘ŠçŸ¥ effect ä¾èµ–ä½œä¸ºä¸€æ¡ç¡¬æ€§è§„åˆ™ï¼Œå¹¶ä¸”è¦åˆ—å‡ºæ‰€æœ‰ä¾èµ–ã€‚â€“ Dan Abramov</p>
</blockquote>
<p>åŠæ³•äºŒï¼šé‡‡ç”¨ <strong>æ›´æ–°å‡½æ•°</strong> æ¥æ”¹å˜ stateã€‚å‰é¢æåˆ°è¿‡ï¼Œ<code>useState</code> çš„ <code>setFunction</code>ä¸­ ï¼Œå¯ä»¥ä¼ ä¸€ä¸ªç®­å¤´å‡½æ•°ï¼ˆæ›´æ–°å‡½æ•°ï¼‰ï¼Œè¿™ä¸ªå‡½æ•°çš„å‚æ•°æ˜¯å½“å‰æœ€æ–°çš„ <code>state</code>ï¼Œ è¿”å›å€¼æ˜¯è¦è®¾ç½®çš„ <code>state</code>ã€‚</p>
<pre><code class="language-jsx">useEffect(() =&gt; {
  let interval;
  if (isOn) {
    interval = setInterval(
      () =&gt; setTimer(val =&gt; val + 1),// çœ‹è¿™é‡Œï¼ï¼ï¼ï¼
      1000,
    );
  }
  return () =&gt; clearInterval(interval);
  },[isOn]); // çœ‹è¿™é‡Œ</code></pre>
<p>å‘ç°æ²¡æœ‰ï¼Œä½¿ç”¨æ›´æ–°å‡½æ•°åï¼Œæˆ‘ä»¬ç›¸å½“äºå»é™¤äº†å¯¹ <code>timer</code> çš„ä¾èµ–ã€‚</p>
<blockquote>
<p>è§„åˆ™ï¼š å½“æˆ‘ä»¬ä¸æƒ³å¢åŠ æ›´å¤šä¾èµ–ï¼Œå¯ä»¥å°è¯•ä¿®æ”¹ effect ä½¿å¾—ä¾èµ–æ›´å°‘ã€‚â€“ Dan Abramov</p>
</blockquote>
<p>æ‰€ä»¥ æ–¹æ³•äºŒ ä¼˜äº æ–¹æ³•ä¸€ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå®é™…é¡¹ç›®ä¸­å¸¸è§çš„å‰¯ä½œç”¨ - Ajaxè¯·æ±‚ã€‚åœ¨class ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šç”¨ç”Ÿå‘½å‘¨æœŸ <code>componentDidMount</code>æ¥å¤„ç†ä¸€äº›åˆå§‹åŒ–çš„ Ajax æ•°æ®è¯·æ±‚ï¼Œç°åœ¨æˆ‘ä»¬ç”¨ useEffect æ¥å®ç°ã€‚</p>
<p>æ¯”å¦‚ç”¨ <code>axios</code> è¯·æ±‚ä¸€ä¸ªåˆ—è¡¨ï¼š</p>
<pre><code class="language-jsx">import React, { useState, useEffect } from &#39;react&#39;;
import axios from &#39;axios&#39;;
function App() {
  const [data, setData] = useState([]);
  useEffect(() =&gt; {
    // æ›´ä¼˜é›…çš„æ–¹å¼
    const fetchData = async () =&gt; {
      const result = await axios(
        &#39;https://hn.algolia.com/api/v1/search?query=redux&#39;,
      );
      setData(result.data);
    };
    fetchData();
  }, []);
  return (
    &lt;ul&gt;
      {data.hits.map(item =&gt; (
        &lt;li key={item.objectID}&gt;
          &lt;a href={item.url}&gt;{item.title}&lt;/a&gt;
        &lt;/li&gt;
      ))}
    &lt;/ul&gt;
  );
}
export default App;</code></pre>
<blockquote>
<p>è§„åˆ™ï¼šuseEffect ä¸èƒ½æ¥æ”¶ async ä½œä¸ºæ‰§è¡Œå‡½æ•°ã€‚useEffect æ¥æ”¶çš„å‡½æ•°ï¼Œè¦ä¹ˆè¿”å›ä¸€ä¸ªèƒ½æ¸…é™¤å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œè¦ä¹ˆå°±ä¸è¿”å›ä»»ä½•å†…å®¹ã€‚è€Œ async è¿”å›çš„æ˜¯ promiseã€‚<br>useEffect è°ƒç”¨çš„å‡½æ•°å¦‚æœä¾èµ– state æˆ–è€… propsã€‚æœ€å¥½åœ¨æ‰§è¡Œå‡½æ•°ä¸­å®šä¹‰ã€‚è¿™æ ·ä¾èµ–å®¹æ˜“è¿½è¸ªã€‚</p>
</blockquote>
<p>useEffect çš„ä½¿ç”¨ï¼Œçœ‹èµ·æ¥å¾ˆç®€å•ã€‚ä½†æ˜¯è¦åšåˆ°ä¸æ»¥ç”¨ï¼Œæ­£ç¡®ä½¿ç”¨ä¹Ÿä¸æ˜¯é‚£ä¹ˆå®¹æ˜“ã€‚ä¸»è¦åœ¨ä½¿ç”¨ä¹‹å‰è¦å¤šä¸€äº›æ€è€ƒã€‚</p>
<h1 id="Custom-Hooks"><a href="#Custom-Hooks" class="headerlink" title="Custom Hooks"></a>Custom Hooks</h1><p>ç»ˆäºè®²åˆ°å®ƒäº†ï¼Œ å‰é¢å·²ç»æåˆ°è¿‡ã€‚å®ƒå¹¶ä¸æ˜¯ <code>React hooks</code> çš„ APIï¼Œè€Œæ˜¯<strong>è‡ªå®šä¹‰ hook</strong>ã€‚é¡¾åæ€ä¹‰ï¼ŒReactå…è®¸ä½ æ„å»ºè‡ªå·±çš„ <code>hooks</code>ã€‚åœ¨å­¦ä¹ å®Œå‰é¢ä¸¤ä¸ªæœ€å—æ¬¢è¿çš„ <code>hooks</code> ä»¥åï¼Œä½ å®Œå…¨å…·å¤‡äº†å®ç°è‡ªå®šä¹‰ hooks çš„èƒ½åŠ›ã€‚</p>
<blockquote>
<p>å®˜ç½‘å®šä¹‰ï¼š è‡ªå®šä¹‰ Hook æ˜¯ä¸€ä¸ª JavaScript å‡½æ•°ï¼Œå…¶åç§°ä»¥ â€useâ€ å¼€å¤´ï¼Œå¯ä»¥è°ƒç”¨å…¶ä»– Hookã€‚</p>
</blockquote>
<p>ä¸ºä»€ä¹ˆéœ€è¦Custom Hooksï¼Ÿ</p>
<ul>
<li><code>useState</code> è§£å†³äº†å‡½æ•°ç»„ä»¶æ— çŠ¶æ€çš„é—®é¢˜ã€‚</li>
<li><code>useEffect</code> å®ç°äº†å‰¯ä½œç”¨ç®¡ç†ï¼Œç”Ÿå‘½å‘¨æœŸçš„åŠŸèƒ½ã€‚</li>
<li><code>Custom Hooks</code> å°†è§£å†³æœ‰çŠ¶æ€ï¼ˆstatefulï¼‰é€»è¾‘å…±äº«çš„é—®é¢˜ï¼ˆç›¸å½“äºç±»ç»„ä»¶ä¸­Hocçš„åŠŸèƒ½ï¼‰ã€‚ğŸ‘‡</li>
</ul>
<p>æˆ‘ä»¬æ¥åˆ°ä¸€ä¸ªå®é™…åœºæ™¯ã€‚å¦‚ä»Š <code>HTML5</code> ç§»åŠ¨åº”ç”¨æˆ– <code>Web app</code> ä¸­è¶Šæ¥è¶Šæ™®éçš„ä½¿ç”¨äº†ç¦»çº¿æµè§ˆæŠ€æœ¯ï¼Œæ‰€ä»¥ç”¨ JS æ£€æµ‹æµè§ˆå™¨åœ¨çº¿/ç¦»çº¿çŠ¶æ€éå¸¸å¸¸è§ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ç”¨ <code>React Hooks</code> æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼š</p>
<pre><code class="language-jsx">import React, { useState, useEffect } from &#39;react&#39;;
function App() {
  const [isOffline, setIsOffline] = useState(window.navigator.onLine);
  // ç¦»çº¿äº‹ä»¶å¤„ç†æ–¹æ³•
  function onOffline() {
    setIsOffline(true);
  }
  // åœ¨çº¿äº‹ä»¶å¤„ç†æ–¹æ³•
  function onOnline() {
    setIsOffline(false);
  }
  useEffect(() =&gt; {
    // äº‹ä»¶ç›‘å¬
    window.addEventListener(&#39;offline&#39;, onOffline);
    window.addEventListener(&#39;online&#39;, onOnline);
    // æ¸…ç†å‡½æ•°
    return () =&gt; {
      window.removeEventListener(&#39;offline&#39;, onOffline);
      window.removeEventListener(&#39;online&#39;, onOnline);
    };
  }, []); // åªéœ€è¦é¦–æ¬¡æ‰§è¡Œ
  return (
    &lt;&gt;
       { 
         isOffline
         ? &lt;div&gt;ç½‘æ–­å·²æ–­å¼€ ...&lt;/div&gt;
         : &lt;div&gt;ç½‘ç»œå·²è¿æ¥ ...&lt;/div&gt;
       }
    &lt;/&gt;
  )
}
export default App;</code></pre>
<blockquote>
<p>æ— è®ºæµè§ˆå™¨æ˜¯å¦åœ¨çº¿ï¼Œ<code>navigator.onLine</code> å±æ€§éƒ½ä¼šæä¾›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚ å¦‚æœæµè§ˆå™¨åœ¨çº¿ï¼Œåˆ™è®¾ç½®ä¸º <code>true</code> ï¼Œå¦åˆ™è®¾ç½®ä¸º <code>false</code> ã€‚</p>
</blockquote>
<p>OKï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªå¾ˆä¸é”™çš„åŠŸèƒ½ã€‚å¾ˆæ˜æ˜¾ï¼Œè¿™ä¸ªåŠŸèƒ½æ˜¯å¯å¤ç”¨çš„ï¼Œåº”è¯¥å…±äº«çš„ã€‚<br>æˆ‘ä»¬æŠŠåŠŸèƒ½é€»è¾‘æå–å‡ºæ¥ï¼ŒæŠŠå®ƒå°è£…æˆä¸€ä¸ª <code>Custom hook</code> å°±å¯ä»¥äº†ï¼š</p>
<pre><code class="language-jsx">import React, { useState, useEffect } from &#39;react&#39;;
// è‡ªå®šä¹‰ hook
function useOffline() {
  const [isOffline, setIsOffline] = useState(window.navigator.onLine);
  function onOffline() {
    setIsOffline(true);
  }
  function onOnline() {
    setIsOffline(false);
  }
  useEffect(() =&gt; {
    window.addEventListener(&#39;offline&#39;, onOffline);
    window.addEventListener(&#39;online&#39;, onOnline);
    return () =&gt; {
      window.removeEventListener(&#39;offline&#39;, onOffline);
      window.removeEventListener(&#39;online&#39;, onOnline);
    };
  }, []);
  return isOffline; // åªæš´éœ²ä¸€ä¸ª state
}

// å‡½æ•°ç»„ä»¶
function App() {
  const isOffline = useOffline();
  return (
    &lt;&gt;
       { 
         isOffline
         ? &lt;div&gt;ç½‘æ–­å·²æ–­å¼€ ...&lt;/div&gt;
         : &lt;div&gt;ç½‘ç»œå·²è¿æ¥ ...&lt;/div&gt;
       }
    &lt;/&gt;
  )
}
export default App;</code></pre>
<p>ç°åœ¨ï¼Œä½ åº”è¯¥å¯¹ <code>custom hooks</code> æœ‰äº†ä¸€ä¸ªç›´è§‚çš„è®¤è¯†ï¼š</p>
<ul>
<li>ä¸€ä¸ªå‡½æ•°ã€‚</li>
<li>ä¸€ä¸ªuseå¼€å¤´çš„å‡½æ•°ã€‚</li>
<li>ä¸€ä¸ªä½¿ç”¨ React hooks å°è£…çš„ï¼Œå¤„ç†å‰¯ä½œç”¨çš„å‡½æ•°ã€‚</li>
<li>ä¸€ä¸ªåœ¨å‡½æ•°ç»„ä»¶ä¸­å¼•å…¥ç®€å•ï¼Œä¸éœ€è¦è°ƒæ•´ç»„ä»¶ç»“æ„çš„å‡½æ•°ã€‚</li>
</ul>
<p>ä»é‡æ„å±‚é¢æ¥è¯´ï¼Œå°±æ˜¯æŠŠç»„ä»¶ä¸­çš„ä¸€äº› <code>hooks</code> æŠ½ç¦»åˆ°ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œå†ä½¿ç”¨è¿™ä¸ªå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å°±æ˜¯ <code>React custom hooks</code>ã€‚</p>
<p>æ—¢ç„¶æ˜¯å‡½æ•°ï¼Œé‚£è‚¯å®šå¯ä»¥ä¼ å‚ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå¸¸è§åœºæ™¯ï¼šå¾ˆå¤šæ—¶å€™ï¼Œä¸ºäº†ç”¨æˆ·ä½“éªŒï¼Œé¡µé¢ä¼šæœ¬åœ°å­˜å‚¨ç”¨æˆ·æ•°æ®ï¼Œç„¶ååœ¨é¡µé¢è¿”å›çš„æ—¶å€™è‡ªåŠ¨å¡«å……ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªä¼ å‚çš„ <code>custom hooks</code> æ¥å®ç°è¯¥åœºæ™¯ï¼š</p>
<pre><code class="language-jsx">import React, { useState, useEffect } from &#39;react&#39;;
// è‡ªå®šä¹‰ hook,æ¥æ”¶ä¸€ä¸ª localStorageKey å‚æ•°
const useStateWithLocalStorage = localStorageKey =&gt; {
  const [value, setValue] = useState(
    localStorage.getItem(localStorageKey) || &#39;&#39;,
  );
  useEffect(() =&gt; {
    localStorage.setItem(localStorageKey, value);
  }, [value]);
  return [value, setValue];
};
const App = () =&gt; {
  // ä½¿ç”¨å¸¦å‚æ•°çš„ è‡ªå®šä¹‰ hooks
  const [value, setValue] = useStateWithLocalStorage(
    &#39;myValueInLocalStorage&#39;,
  );
  const onChange = event =&gt; setValue(event.target.value);
  return (
    &lt;div&gt;
      &lt;input value={value} type=&quot;text&quot; onChange={onChange} /&gt;
      &lt;p&gt;{value}&lt;/p&gt;
    &lt;/div&gt;
  );
};</code></pre>
<p>ä¹¦å†™ custom hooks éœ€è¦æ³¨æ„äº›ä»€ä¹ˆå‘¢ï¼Ÿçœ‹å®˜ç½‘æ€ä¹ˆè¯´ï¼š</p>
<ul>
<li>è‡ªå®šä¹‰ Hooks æ˜¯ä¸€ç§æƒ¯ä¾‹ï¼Œå®ƒè‡ªç„¶åœ°éµå¾ª Hooks è®¾è®¡çš„çº¦å®šã€‚å³éµå¾ªæ‰€æœ‰ä½ ç”¨åˆ°çš„ <code>Hooks</code>  çš„è§„åˆ™ã€‚</li>
<li>è¯·ä½¿ç”¨ use å¼€å¤´ã€‚è¿™ä¸ªä¹ æƒ¯éå¸¸é‡è¦ã€‚å¦‚æœæ²¡æœ‰å®ƒï¼Œæˆ‘ä»¬å°±ä¸èƒ½è‡ªåŠ¨æ£€æŸ¥è¯¥ Hook æ˜¯å¦è¿åäº† Hooks çš„è§„åˆ™ï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•åˆ¤æ–­æŸä¸ªå‡½æ•°æ˜¯å¦åŒ…å«å¯¹å…¶å†…éƒ¨ Hooks çš„è°ƒç”¨ã€‚</li>
</ul>
<h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><p>é¡ºåºè°ƒç”¨ï¼šæ¯ä¸ªç»„ä»¶éƒ½æœ‰ä¸€ä¸ª â€œå†…å­˜å•å…ƒâ€ çš„å†…éƒ¨åˆ—è¡¨ã€‚å®ƒä»¬åªæ˜¯ <code>JavaScript</code> å¯¹è±¡ï¼Œä½ å¯ä»¥æƒ³è±¡å®ƒæ˜¯ä¸€ä¸ªæ•°ç»„ï¼ˆå®é™…ä¸Šæ˜¯ä¸€ä¸ªå•å‘é“¾è¡¨ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­æ”¾ç½®ä¸€äº›æ•°æ®ã€‚å½“è°ƒç”¨ <code>useState()</code> è¿™æ ·çš„ <code>Hook</code> æ—¶ï¼Œå®ƒè¯»å–å½“å‰å•å…ƒæ ¼(æˆ–åœ¨ç¬¬ä¸€æ¬¡å‘ˆç°æ—¶åˆå§‹åŒ–å®ƒ)ï¼Œç„¶åå°†æŒ‡é’ˆç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå•å…ƒæ ¼ã€‚è¿™å°±æ˜¯å¤šä¸ª <code>useState()</code> è°ƒç”¨å„è‡ªè·å–ç‹¬ç«‹æœ¬åœ°çŠ¶æ€çš„æ–¹å¼ã€‚</p>
<ul>
<li><code>Hooks</code> çš„çŠ¶æ€å€¼éƒ½è¢«æŒ‚è½½åœ¨ç»„ä»¶å®ä¾‹å¯¹è±¡ <code>FiberNode</code> çš„å±æ€§ä¸­ã€‚</li>
<li><code>Hooks</code> æ˜¯ç”¨é“¾è¡¨æ¥ä¿å­˜çŠ¶æ€çš„ï¼Œå±æ€§ä¿å­˜çš„å®é™…ä¸Šæ˜¯è¿™ä¸ªé“¾è¡¨çš„å¤´æŒ‡é’ˆã€‚</li>
<li><code>useState / useReducer</code> çš„ä¿¡æ¯ä¿å­˜åœ¨ <code>FiberNode.memoizedState</code>å±æ€§.</li>
<li><code>useEffect</code> ä¹Ÿæ˜¯ä»¥é“¾è¡¨çš„å½¢å¼æŒ‚è½½åœ¨ <code>FiberNode.updateQueue</code> å±æ€§ä¸­ã€‚</li>
</ul>
<pre><code class="language-js">// react-reconciler/src/ReactFiberHooks.js
export type Hook = {
  memoizedState: any, // æœ€æ–°çš„çŠ¶æ€å€¼
  baseState: any, // åˆå§‹çŠ¶æ€å€¼ï¼Œå¦‚`useState(0)`ï¼Œåˆ™åˆå§‹å€¼ä¸º0
  baseUpdate: Update&lt;any, any&gt; | null,
  queue: UpdateQueue&lt;any, any&gt; | null, // ä¸´æ—¶ä¿å­˜å¯¹çŠ¶æ€å€¼çš„æ“ä½œï¼Œæ›´å‡†ç¡®æ¥è¯´æ˜¯ä¸€ä¸ªé“¾è¡¨æ•°æ®ç»“æ„ä¸­çš„ä¸€ä¸ªæŒ‡é’ˆ
  next: Hook | null,  // æŒ‡å‘ä¸‹ä¸€ä¸ªé“¾è¡¨èŠ‚ç‚¹
};

 const effect: Effect = {
    tag, // ç”¨æ¥æ ‡è¯†ä¾èµ–é¡¹æœ‰æ²¡æœ‰å˜åŠ¨
    create, // ç”¨æˆ·ä½¿ç”¨useEffectä¼ å…¥çš„å‡½æ•°ä½“
    destroy, // ä¸Šè¿°å‡½æ•°ä½“æ‰§è¡Œåç”Ÿæˆçš„ç”¨æ¥æ¸…é™¤å‰¯ä½œç”¨çš„å‡½æ•°
    deps, // ä¾èµ–é¡¹åˆ—è¡¨
    next: (null: any),
};</code></pre>
<p>æƒ³æ›´è¯¦ç»†çš„ç†è§£ï¼Œè¯·ç‚¹å‡»ï¼š<br><a href="https://juejin.im/post/5bebd1bbe51d4561ce39a23b" target="_blank" rel="noopener">React Hooks æ­ç§˜</a><br><a href="https://segmentfault.com/a/1190000023041842" target="_blank" rel="noopener">React Hooks åŸç†å‰–æ</a></p>
<h1 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h1><p>éœ€è¦å¼€å‘è€…éµä»è®¸å¤šè§„åˆ™ã€‚ç†è§£å¹¶åˆç†è¿ç”¨è¿™äº›è§„åˆ™ï¼Œèƒ½å†™å‡ºä¼˜é›…çš„ï¼Œå¯è¯»æ€§é«˜çš„ï¼Œæ€§èƒ½å¥½çš„ä»£ç ã€‚åä¹‹ï¼Œå¾ˆå®¹æ˜“å‡ºç°æ­»å¾ªç¯ï¼Œæ•°æ®é‡å¤è¯·æ±‚ç­‰é—®é¢˜ã€‚æœ€è®©äººæ‹…å¿ƒçš„æ˜¯æ€§èƒ½ï¼Œå¾ˆå¤šæ—¶å€™ä¸šåŠ¡åŠŸèƒ½å®ç°äº†ï¼Œä½†æ˜¯å…¶å®å­˜åœ¨å¾ˆå¤šä¸å¿…è¦çš„å¼€é”€ã€‚</p>
<hr>
<p><strong>å‚è€ƒèµ„æ–™</strong><br><a href="http://react.html.cn/docs/hooks-intro.html" target="_blank" rel="noopener">å®˜ç½‘-Hooks</a><br><a href="https://www.robinwieruch.de/react-hooks" target="_blank" rel="noopener">What Are React Hooks</a><br><a href="https://juejin.im/post/5dbbdbd5f265da4d4b5fe57d#heading-17" target="_blank" rel="noopener">React Hooks è¯¦è§£ + é¡¹ç›®å®æˆ˜</a></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/hooks/" rel="tag"># hooks</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/03/11/%E5%85%B3%E4%BA%8Efetch/" rel="next" title="å…³äºfetch">
                <i class="fa fa-chevron-left"></i> å…³äºfetch
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/03/30/%E6%8B%A5%E6%8A%B1React-Hooks%EF%BC%88%E4%BA%8C%EF%BC%89-Refs/" rel="prev" title="æ‹¥æŠ±React-Hooksï¼ˆäºŒï¼‰- useRef">
                æ‹¥æŠ±React-Hooksï¼ˆäºŒï¼‰- useRef <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/sgj.jpeg"
                alt="ç¥è¿" />
            
              <p class="site-author-name" itemprop="name">ç¥è¿</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">59</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">åˆ†ç±»</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                å¤§ç‰›ğŸ‘‡
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.ruanyifeng.com/blog/" title="é˜®ä¸€å³°" target="_blank">é˜®ä¸€å³°</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://overreacted.io/zh-hans/" title="Dan Abramov" target="_blank">Dan Abramov</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://qianduan.group/" title="å¯¸å¿—" target="_blank">å¯¸å¿—</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.robinwieruch.de/blog" title="Robin Wieruch" target="_blank">Robin Wieruch</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#React-Hooks-èµ·æº"><span class="nav-number">1.</span> <span class="nav-text">React Hooks èµ·æº</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ç±»ç»„ä»¶è¢«è¯Ÿç—…"><span class="nav-number">2.</span> <span class="nav-text">ç±»ç»„ä»¶è¢«è¯Ÿç—…</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Hooks-ä¼˜è¶Šæ€§"><span class="nav-number">3.</span> <span class="nav-text">Hooks ä¼˜è¶Šæ€§</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#æŠ›å¼ƒç±»ç»„ä»¶ï¼Ÿ"><span class="nav-number">4.</span> <span class="nav-text">æŠ›å¼ƒç±»ç»„ä»¶ï¼Ÿ</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#useState-hook"><span class="nav-number">5.</span> <span class="nav-text">useState hook</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#useStateã€Œç²’åº¦ã€é—®é¢˜"><span class="nav-number">5.1.</span> <span class="nav-text">useStateã€Œç²’åº¦ã€é—®é¢˜</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#useEffect-hook"><span class="nav-number">6.</span> <span class="nav-text">useEffect hook</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ä¸éœ€è¦æ¸…ç†çš„åœºæ™¯"><span class="nav-number">6.1.</span> <span class="nav-text">ä¸éœ€è¦æ¸…ç†çš„åœºæ™¯</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#éœ€è¦æ¸…ç†çš„åœºæ™¯"><span class="nav-number">6.2.</span> <span class="nav-text">éœ€è¦æ¸…ç†çš„åœºæ™¯</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Custom-Hooks"><span class="nav-number">7.</span> <span class="nav-text">Custom Hooks</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#åŸç†"><span class="nav-number">8.</span> <span class="nav-text">åŸç†</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ç¼ºç‚¹"><span class="nav-number">9.</span> <span class="nav-text">ç¼ºç‚¹</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ç¥è¿</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




<script src="/js/prism/prism.js" async></script>
        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"react":{"opacity":0.9},"log":false});</script></body>
</html>
